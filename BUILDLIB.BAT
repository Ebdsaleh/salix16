@ECHO OFF
REM BUILDLIB.BAT
ECHO Building Salix16 Library with Debug Symbols...

REM --- 1. Ensure Directory Structure ---
IF NOT EXIST BACKUP MKDIR BACKUP
IF NOT EXIST BACKUP\SRC MKDIR BACKUP
IF NOT EXIST BACKUP\SRC\CORE MKDIR BACKUP\SRC\CORE
IF NOT EXIST BACKUP\SRC\INPUT MKDIR BACKUP\SRC\INPUT
IF NOT EXIST BACKUP\SRC\VIDEO MKDIR BACKUP\SRC\VIDEO
IF NOT EXIST BACKUP\SRC\TUI MKDIR BACKUP\SRC\TUI
IF NOT EXIST BUILD MKDIR BUILD
IF NOT EXIST BIN MKDIR BIN

ECHO Vaulting source files to BACKUP...

REM --- 2. THE VAULT (Backup before Assemble) ---
IF EXIST SRC\CORE\DETECT.ASM   COPY SRC\CORE\DETECT.ASM   BACKUP\SRC\CORE\DETECT.ASM
IF EXIST SRC\CORE\MEM_GAP.ASM  COPY SRC\CORE\MEM_GAP.ASM  BACKUP\SRC\CORE\MEM_GAP.ASM
IF EXIST SRC\INPUT\KBD.ASM     COPY SRC\INPUT\KBD.ASM     BACKUP\SRC\INPUT\KBD.ASM
IF EXIST SRC\INPUT\KBD_HW.ASM  COPY SRC\INPUT\KBD_HW.ASM  BACKUP\SRC\INPUT\KBD_HW.ASM
IF EXIST SRC\VIDEO\VID_TEXT.ASM COPY SRC\VIDEO\VID_TEXT.ASM BACKUP\SRC\VIDEO\VID_TEXT.ASM
IF EXIST SRC\VIDEO\VID_GEOM.ASM COPY SRC\VIDEO\VID_GEOM.ASM BACKUP\SRC\VIDEO\VID_GEOM.ASM
IF EXIST SRC\VIDEO\VID_COMP.ASM COPY SRC\VIDEO\VID_COMP.ASM BACKUP\SRC\VIDEO\VID_COMP.ASM
IF EXIST SRC\TUI\TUI_CORE.ASM  COPY SRC\TUI\TUI_CORE.ASM  BACKUP\SRC\TUI\TUI_CORE.ASM
IF EXIST SRC\TUI\TUI_MENU.ASM  COPY SRC\TUI\TUI_MENU.ASM  BACKUP\SRC\TUI\TUI_MENU.ASM

ECHO Assemble phase starting...

REM --- 3. ASSEMBLE (With Symbols for SoftICE) ---
TASM /zi /iINCLUDE SRC\CORE\DETECT.ASM, BUILD\DETECT.OBJ
TASM /zi /iINCLUDE SRC\CORE\MEM_GAP.ASM, BUILD\MEM_GAP.OBJ
TASM /zi /iINCLUDE SRC\INPUT\KBD.ASM, BUILD\KBD.OBJ
TASM /zi /iINCLUDE SRC\INPUT\KBD_HW.ASM, BUILD\KBD_HW.OBJ
TASM /zi /iINCLUDE SRC\VIDEO\VID_TEXT.ASM, BUILD\VID_TEXT.OBJ
TASM /zi /iINCLUDE SRC\VIDEO\VID_GEOM.ASM, BUILD\VID_GEOM.OBJ
TASM /zi /iINCLUDE SRC\VIDEO\VID_COMP.ASM, BUILD\VID_COMP.OBJ
TASM /zi /iINCLUDE SRC\TUI\TUI_CORE.ASM, BUILD\TUI_CORE.OBJ
TASM /zi /iINCLUDE SRC\TUI\TUI_MENU.ASM, BUILD\TUI_MENU.OBJ

REM --- 4. THE LIBRARY (Atomic Call) ---
REM We use the @ list directly here to avoid the interactive MAKELIB hang.
IF EXIST BIN\SALIX16.LIB DEL BIN\SALIX16.LIB
TLIB BIN\SALIX16.LIB @LIBLIST.TXT
MAKELIB.BAT